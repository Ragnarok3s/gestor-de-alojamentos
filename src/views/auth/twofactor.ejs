<%
  const brand = branding || {};
  const brandName = brand.brandName || 'Gestor de Alojamentos';
  const logoPath = brand.logoPath;
  const logoAlt = brand.logoAlt || `${brandName} · logótipo`;
  const initialsSource = brand.brandInitials || brandName;
  const initials = (initialsSource && initialsSource.replace(/[^\p{L}\p{N}]+/gu, '').slice(0, 2).toUpperCase()) || 'GA';
  const translator = typeof t === 'function' ? t : (key => key);
  const destinationEmail = maskedEmail || 'o seu email';
  const safeDestination = esc(destinationEmail);
  const descriptionTemplate = translator('auth.twofactor.description');
  const description = descriptionTemplate.replace('{destination}', `<strong>${safeDestination}</strong>`);
%>
<div class="auth-wrapper">
  <div class="auth-card card">
    <div class="auth-branding">
      <div class="auth-logo">
        <% if (logoPath) { %>
          <img src="<%= esc(logoPath) %>" alt="<%= esc(logoAlt) %>" class="auth-logo__image" />
        <% } else { %>
          <span class="auth-logo__initials"><%= esc(initials) %></span>
        <% } %>
      </div>
      <h1 class="auth-title"><%= esc(translator('auth.twofactor.title')) %></h1>
      <p class="auth-subtitle"><%- description %></p>
    </div>

    <% if (noticeMessage) { %>
      <div class="auth-alert auth-alert--success" role="status"><%= esc(noticeMessage) %></div>
    <% } %>
    <% if (errorMessage) { %>
      <div class="auth-alert auth-alert--error" role="alert"><%= esc(errorMessage) %></div>
    <% } %>

    <form class="auth-form" method="post" action="/login/2fa">
      <input type="hidden" name="_csrf" value="<%= esc(csrfToken || '') %>" />
      <div class="auth-field">
        <label class="auth-label" for="tfa-code"><%= esc(translator('auth.twofactor.codeLabel')) %></label>
        <div class="auth-input">
          <span class="auth-input__icon"><%- include('../partials/icon', { name: 'shield-check' }) %></span>
          <input
            id="tfa-code"
            class="auth-input__field"
            name="code"
            placeholder="<%= esc(translator('auth.placeholder.twoFactor')) %>"
            inputmode="numeric"
            pattern="[0-9]*"
            autocomplete="one-time-code"
            required
            autofocus
          />
        </div>
      </div>
      <button class="btn btn-primary auth-submit" type="submit"><%= esc(translator('auth.twofactor.submit')) %></button>
    </form>

    <form class="auth-form auth-form--secondary" method="post" action="/login/2fa/resend">
      <input type="hidden" name="_csrf" value="<%= esc(csrfToken || '') %>" />
      <button class="btn btn-light auth-submit" type="submit"><%= esc(translator('auth.twofactor.resend')) %></button>
    </form>

    <form class="auth-form auth-form--secondary" method="post" action="/login/2fa/cancel">
      <input type="hidden" name="_csrf" value="<%= esc(csrfToken || '') %>" />
      <button class="btn btn-light auth-submit" type="submit"><%= esc(translator('actions.cancel') || 'Cancelar') %></button>
    </form>
  </div>
</div>
