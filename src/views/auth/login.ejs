<%
  const brand = branding || {};
  const brandName = brand.brandName || 'Gestor de Alojamentos';
  const logoPath = brand.logoPath;
  const logoAlt = brand.logoAlt || `${brandName} · logótipo`;
  const initialsSource = brand.brandInitials || brandName;
  const initials = (initialsSource && initialsSource.replace(/[^\p{L}\p{N}]+/gu, '').slice(0, 2).toUpperCase()) || 'GA';
  const translator = typeof t === 'function' ? t : (key => key);
  const subtitleText = brand.tagline
    ? brand.tagline
    : translator('auth.subtitle', { brand: brandName });
%>
<div class="auth-wrapper">
  <div class="auth-card card">
    <div class="auth-branding">
      <div class="auth-logo">
        <% if (logoPath) { %>
          <img src="<%= esc(logoPath) %>" alt="<%= esc(logoAlt) %>" class="auth-logo__image" />
        <% } else { %>
          <span class="auth-logo__initials"><%= esc(initials) %></span>
        <% } %>
      </div>
      <h1 class="auth-title"><%= esc(translator('auth.welcome')) %></h1>
      <p class="auth-subtitle"><%= esc(subtitleText) %></p>
    </div>

    <% if (noticeMessage) { %>
      <div class="auth-alert auth-alert--success" role="status"><%= esc(noticeMessage) %></div>
    <% } %>
    <% if (errorMessage) { %>
      <div class="auth-alert auth-alert--error" role="alert"><%= esc(errorMessage) %></div>
    <% } %>

    <form class="auth-form" method="post" action="/login">
      <input type="hidden" name="_csrf" value="<%= esc(csrfToken || '') %>" />
      <% if (next) { %>
        <input type="hidden" name="next" value="<%= esc(next) %>" />
      <% } %>

      <div class="auth-field">
        <label class="auth-label" for="login-username"><%= esc(translator('auth.usernameLabel')) %></label>
        <div class="auth-input">
          <span class="auth-input__icon"><%- include('../partials/icon', { name: 'user' }) %></span>
          <input
            id="login-username"
            class="auth-input__field"
            name="username"
            placeholder="<%= esc(translator('auth.placeholder.username')) %>"
            value="<%= esc(username || '') %>"
            autocomplete="username"
            required
            autofocus
          />
        </div>
      </div>

      <div class="auth-field">
        <label class="auth-label" for="login-password"><%= esc(translator('auth.passwordLabel')) %></label>
        <div class="auth-input">
          <span class="auth-input__icon"><%- include('../partials/icon', { name: 'lock' }) %></span>
          <input
            id="login-password"
            class="auth-input__field"
            type="password"
            name="password"
            placeholder="<%= esc(translator('auth.placeholder.password')) %>"
            autocomplete="current-password"
            required
          />
        </div>
      </div>

      <button class="btn btn-primary auth-submit" type="submit"><%= esc(translator('auth.signIn')) %></button>
    </form>

    <div class="auth-links">
      <a href="/login/reset"><%= esc(translator('auth.forgotPassword')) %></a>
    </div>
  </div>
</div>
